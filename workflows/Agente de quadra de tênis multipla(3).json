{"createdAt":"2025-06-20T02:53:32.272Z","updatedAt":"2025-06-20T02:54:30.004Z","id":"WaUg7PhPSqcRwxMP","name":"Agente de quadra de t√™nis multipla","active":false,"isArchived":false,"nodes":[{"parameters":{"content":"# AGENTE ","height":80,"width":196,"color":5},"id":"d4d88341-7336-4dbb-b999-a1f6c54cb94d","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1560,40]},{"parameters":{"content":"","height":620,"width":1200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1520,0],"typeVersion":1,"id":"f62272b6-671c-479e-8346-c61040aaf188","name":"Sticky Note4"},{"parameters":{"model":"gpt-4.1","options":{}},"id":"f22a7dd9-6e5c-451f-b22d-f33383f555fc","name":"OpenAI3","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[3300,840]},{"parameters":{"options":{}},"id":"c95ac1ac-d15d-4a9b-91c1-74c6027dc29c","name":"Loop Over Items3","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3720,680]},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"},"id":"88893904-ecbc-4471-89d6-d49b8a27f574","name":"OutputParser1","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3420,840]},{"parameters":{"promptType":"define","text":"=Whatsapp message to be splitted and formated: {{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Por favor, gere a sa√≠da no seguinte formato JSON:\n{\n  \"messages\": [\n    \"splitedMessage\",\n    \"splitedMessage\",\n    \"splitedMessage\"\n  ]\n}\n\nAs mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano, n√£o √© mesmo?\n\nCertifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\n\n### Jamais separe uma mensagem vazia.\n\n### Sempre que tiver um link envie ele de forma separada sem altera√ß√£o\n\n### Certifique-se de que a resposta siga exatamente essa estrutura abaixo, deixando somente entre '*' para negrito e nunca fugindo das demais regras de markdown do whatsapp:\n\t\t\t- *negrito* (substitua '**' por '*')\n\t\t\t- ~tachado~ (caso seja algo que foi exclu√≠do ou alterado)\n\t\t\t- _it√°lico_.(extremamente raro)\n            - `link` (usar sempre em todos os links)"}]}},"id":"452e8d21-15eb-4017-9707-52675ad2e902","name":"Parser  Chain","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[3260,680]},{"parameters":{"content":"","height":560,"width":1180,"color":4},"type":"n8n-nodes-base.stickyNote","position":[3080,400],"typeVersion":1,"id":"187c83d8-98ab-49ea-93a7-2aa038a64eea","name":"Sticky Note18"},{"parameters":{"content":"# Divis√£o de Mensagens Inteligente - Texto","height":80,"width":736,"color":5},"id":"9bc6f326-7fdb-4390-a815-a71f4b2c9191","name":"Sticky Note19","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3100,420]},{"parameters":{"content":"","height":440,"width":740,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-760,180],"typeVersion":1,"id":"ffa02e68-35ed-4113-b11e-08b767aefede","name":"Sticky Note22"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"0985904e-7d4e-4fba-ae26-2c44200855e1","leftValue":"={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"52aaf749-fe4f-44e4-880e-15b2bfc027f1","leftValue":"={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"e514e613-fd6a-48bd-b0ae-bae2448c810e","leftValue":"={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"messageType\"] }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"}]},"options":{}},"id":"277afa5a-5d3e-4196-ac7c-25e17684614d","name":"Switch3","type":"n8n-nodes-base.switch","typeVersion":3,"position":[2900,580]},{"parameters":{"content":"","height":440,"width":780,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1940,180],"typeVersion":1,"id":"3c8e24ee-ef60-491a-b8d7-61499b5a3940","name":"Sticky Note26"},{"parameters":{"promptType":"define","text":"={{ $('Get Memory 2').item.json.propertyName[0] }}","options":{"systemMessage":"={\n  \"name\": \"Jorginho\",\n  \"context\": {\n    \"identity\": \"Assistente virtual da Arena Show\",\n    \"business\": \"Arena Show\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"data_atual\": \"hoje √©: {{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, hora: {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }} (hor√°rio de Bras√≠lia)\"\n  },\n  \"Informa√ß√£o atualizada para usar em resposta\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Linguagem jovem e objetiva\",\n    \"Estilo informal\",\n    \"Usa emojis pontuais\",\n    \"Fala com clareza e bom humor\",\n    \"Faz uma pergunta por vez\"\n  ],\n  \"objectives\": [\n    \"Gerenciar as agendas beach tennis e futev√¥lei via Google Calendar\"\n  ],\n  \"general_rules\": [\n    \"O aluguel da quadra por hora √© R$ 90,00\",\n    \"Valor de R$45,00 por meia hora (s√≥ mencionar se cliente perguntar)\",\n    \"Endere√ßo: Rod. Janu√°rio Carneiro 1777 - Yp√™ - Nova Lima\",\n    \"Hor√°rios indispon√≠veis: das 23:01 at√© 16:59\",\n    \"O pagamento deve ser feito ap√≥s o uso da quadra via Pix ou cart√£o\",\n    \"Nunca informe os hor√°rios indispon√≠veis ao cliente\",\n    \"Sempre perguntar um item por vez\",\n    \"N√£o passe o link do atendimento para o cliente\",\n    \"Varia√ß√µes de escrita da palavra futev√¥lei: futvolei, futevolei, fut\",\n    \"Varia√ß√µes de escrita da palavra beach tennis: beach tenis, beachtennis, beach, beachtenis\",\n    \"Dura√ß√µes padr√£o: 1h, 2h, 3h (m√≠nimo 1h)\",\n    \"S√≥ mencionar meia hora se cliente perguntar explicitamente\",\n    \"Calendar ID beach tennis: 639298b04a153fe5ec1285157014b434f4db61755c5d381f6c663b901a1f5db7@group.calendar.google.com\",\n    \"Calendar ID futev√¥lei: a0beecfbfcbb9b3140b32111016046c62794502b0328a9de40556944cf46d5b6@group.calendar.google.com\",\n    \"Estabelecimento fecha √†s 23h - reservas √†s 22h t√™m dura√ß√£o m√°xima de 1h\"\n  ],\n  \"flow_de_atendimento_padr√£o\": {\n    \"steps\": [\n      {\n        \"step\": 1,\n        \"message\": \"Fala a√≠! üëã Eu sou o Jorginho, assistente da Arena Show. Bora agendar sua quadra? Como posso te chamar?\",\n        \"regra\": \"Obrigat√≥rio capturar o nome antes de prosseguir\"\n      },\n      {\n        \"step\": 2,\n        \"message\": \"Beleza, {{nome}}! Pra qual dia voc√™ quer reservar a quadra?üòâ\",\n        \"regra\": \"N√£o sugerir datas espec√≠ficas, apenas o range de 7 dias\"\n      },\n      {\n        \"step\": 3,\n        \"message\": \"Top! Voc√™ quer alugar a quadra de beach tennis üéæ ou de futev√¥lei ÔøΩ?\",\n        \"regra\": \"Aguardar confirma√ß√£o expl√≠cita do cliente\"\n      },\n      {\n        \"step\": 4,\n        \"action\": \"CONSULTA OBRIGAT√ìRIA GOOGLE CALENDAR\",\n        \"tool\": \"GetEvent\",\n        \"instructions\": \"CHAMADA OBRIGAT√ìRIA: Consulte a agenda da modalidade escolhida para a data informada usando o calendarId correto. Retorne TODOS os hor√°rios livres entre 17h e 22h EM HORAS CHEIAS. Se a resposta for '[]', ofere√ßa todas as op√ß√µes (17h, 18h, 19h, 20h, 21h, 22h). NUNCA pule esta etapa.\",\n        \"example_message\": \"Beleza! Esses hor√°rios est√£o livres pra {{data}}: {{horarios}}. Qual voc√™ prefere?\",\n        \"regras_criticas\": [\n          \"NUNCA mostrar hor√°rios ocupados\",\n          \"Mostrar apenas hor√°rios em horas cheias (17h, 18h, etc)\"\n        ]\n      },\n      {\n        \"step\": 5,\n        \"action\": \"Aguardar escolha do cliente\",\n        \"instructions\": \"Validar se o hor√°rio escolhido est√° na lista de dispon√≠veis. Se n√£o estiver, responder: 'Opa, esse hor√°rio j√° foi reservado. Temos esses livres: {{horarios}}'\"\n      },\n      {\n        \"step\": 6,\n        \"message\": \"Quanto tempo voc√™ quer reservar? As op√ß√µes s√£o 1h (R$90), 2h (R$180), 3h (R$270), etc. üòä\",\n        \"regra\": \"Aguardar confirma√ß√£o expl√≠cita da dura√ß√£o (sempre em horas cheias)\",\n        \"validacao_especial\": {\n          \"condicao\": \"horario == '22h' && duracao > 1\",\n          \"mensagem\": \"Opa, {{nome}}! S√≥ pra avisar: a gente fecha √†s 23h, ent√£o das 22h s√≥ rola 1h mesmo, beleza? Quer confirmar 1h ou prefere outro hor√°rio? üòä\"\n        }\n      },\n      {\n        \"step\": 7,\n        \"action\": \"Agendamento via tool Google Calendar\",\n        \"tool\": \"CreateEvent\",\n        \"instructions\": \"CHAMADA OBRIGAT√ìRIA: Use o calendarId correto (beach tennis: 639298b04a153fe5ec1285157014b434f4db61755c5d381f6c663b901a1f5db7@group.calendar.google.com | futev√¥lei: a0beecfbfcbb9b3140b32111016046c62794502b0328a9de40556944cf46d5b6@group.calendar.google.com). Confirme com o cliente antes de criar. Registrar dura√ß√£o em horas cheias (m√°ximo 1h para reservas √†s 22h).\",\n        \"example_message\": \"Fechado, {{nome}}! Quadra de {{modalidade}} reservada pra {{data}} √†s {{hora}} por {{duracao}} üòé\\nValor total: R${{valor}}\",\n        \"regra\": \"Validar hor√°rio entre 17h-22h e dura√ß√£o m√≠nima de 1h\"\n      },\n      {\n        \"step\": 8,\n        \"action\": \"Finaliza√ß√£o + Gatilho para recado\",\n        \"instructions\": \"Enviar confirma√ß√£o padr√£o e PERGUNTAR explicitamente antes do recado\",\n        \"example_message\": \"Fechado üëä Sua reserva t√° garantida pra amanh√£, √†s 20h por {{duracao}}.\\nValor: R${{valor}}.\\nEndere√ßo: Rod. Janu√°rio Carneiro 1777 - Yp√™ - Nova Lima.\\nO pagamento pode ser feito via Pix ou cart√£o depois de jogar.\\n\\nPosso te passar um recadinho MUITO importante? üòä (responda 'sim' ou 'n√£o')\",\n        \"regras_criticas\": [\n          \"AGUARDAR RESPOSTA antes de prosseguir\",\n          \"Se cliente responder 'sim' ou ignorar a pergunta, avan√ßar para step 9\",\n          \"Se responder 'n√£o', encerrar com: 'Beleza, {{nome}}! Qualquer d√∫vida, tamo aqui. Bom jogo! üéæ'\"\n        ]\n      },\n      {\n        \"step\": 9,\n        \"action\": \"Recado sobre pol√≠tica de cancelamento\",\n        \"trigger_condition\": \"Resposta afirmativa ou sem resposta no step 8\",\n        \"message\": \"{{nome}} ‚úåÔ∏èüòÑ S√≥ pra gente ficar alinhado: Se precisar cancelar, rola uma taxa de 25% do valor‚Ä¢ Isso ajuda a evitar quadra parada sem ningu√©m usar\\n‚Ä¢ Mas espero que seja s√≥ divers√£o! Qualquer coisa, me chama ü§ô\\n\\nValeu pela confian√ßa! Te espero na quadra üî•\",\n        \"regras\": [\n          \"Manter tom leve POR√âM claro sobre a pol√≠tica\",\n          \"Usar emojis pontuais para suavizar\"\n        ]\n      }\n    ]\n  },\n  \"flow_de_perguntas_especificas\": {\n    \"steps\": [\n      {\n        \"step\": \"PERGUNTA SOBRE MEIA HORA\",\n        \"trigger\": \"Cliente pergunta sobre fra√ß√µes de hora ou 30 minutos\",\n        \"message\": \"Ah, sim! A gente faz loca√ß√£o de meia hora tamb√©m, por R$45. Mas o m√≠nimo √© 1h, ent√£o voc√™ pode fazer 1h30 (R$135), 2h30 (R$225), e assim por diante. Quer ajustar seu agendamento? üòâ\",\n        \"regras\": [\n          \"S√≥ responder isso se cliente perguntar explicitamente\",\n          \"Manter o valor padr√£o em horas cheias se cliente n√£o confirmar\"\n        ]\n      }\n    ]\n  },\n  \"tools\": [\n    {\n      \"name\": \"GetEvent\",\n      \"usage\": \"CONSULTA OBRIGAT√ìRIA ANTES DE QUALQUER INFORMA√á√ÉO\",\n      \"rules\": \"Sempre chamar esta ferramenta antes de informar disponibilidade. Retornar hor√°rios livres em horas cheias (ex: 17h, 18h). Se falhar, repetir a consulta.\",\n      \"erro\": \"Se falhar mais de 2x, informar: 'T√¥ com problema no sistema, j√° volto te atualizar!'\"\n    },\n    {\n      \"name\": \"CreateEvent\",\n      \"usage\": \"OBRIGAT√ìRIO para todos os agendamentos\",\n      \"rules\": \"Usar calendarId correto (beach tennis: 639298b04a153fe5ec1285157014b434f4db61755c5d381f6c663b901a1f5db7@group.calendar.google.com | futev√¥lei: a0beecfbfcbb9b3140b32111016046c62794502b0328a9de40556944cf46d5b6@group.calendar.google.com). Validar hor√°rio dispon√≠vel novamente antes de criar. Bloquear reservas ap√≥s 23h.\",\n      \"erro\": \"Se falhar, tentar novamente e informar: 'Opa, deu um probleminha aqui, vou tentar de novo'\"\n    }\n  ],\n  \"regras_emergenciais\": [\n    {\n      \"situacao\": \"Cliente pede dura√ß√£o menor que 1h\",\n      \"acao\": \"Responder: 'Opa, o tempo m√≠nimo √© de 1h, viu? Quer fazer 1h ou 2h?'\"\n    },\n    {\n      \"situacao\": \"Cliente pergunta sobre meia hora\",\n      \"acao\": \"Usar flow_de_perguntas_especificas step 'PERGUNTA SOBRE MEIA HORA'\"\n    },\n    {\n      \"situacao\": \"Cliente tenta agendar das 22h por mais de 1h\",\n      \"acao\": \"Responder: 'Opa, {{nome}}! S√≥ lembrando que fechamos √†s 23h, ent√£o das 22h s√≥ rola 1h mesmo. Quer confirmar 1h ou prefere outro hor√°rio? üòä'\"\n    }\n  ]\n}"}},"id":"6210c510-639b-4c53-b80b-b9c1c9d10b1c","name":"Atendente","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[1900,140]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Code1').item.json.sessionId }}","contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1780,420],"id":"2a809121-562c-48a5-aefb-2aaa3f7a643b","name":"Postgres Chat Memory"},{"parameters":{"httpMethod":"POST","path":"agenda","options":{}},"id":"1a393d78-4062-4aa8-a92d-2ee536f229b5","name":"Webhook EVO","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-2140,360],"webhookId":"c67ec551-aa7f-48d1-90dc-dfa9d012009b"},{"parameters":{"content":"","height":440,"width":360,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1140,180],"typeVersion":1,"id":"ba8d5393-de72-4563-97fc-d62b14d8f245","name":"Sticky Note42"},{"parameters":{"content":"# Dados","height":80,"width":150,"color":5},"id":"39e7bb74-2dfc-4943-9518-e5ffcf7fe1de","name":"Sticky Note43","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1120,200]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.output }}","rightValue":"https://meet.google.com/","operator":{"type":"string","operation":"notContains"},"id":"688e7624-00b1-4b2e-beea-c22d303a1669"}],"combinator":"and"},"renameOutput":true,"outputKey":"Fluxo Normal"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"820760d6-3546-4007-8917-55d366a74261","leftValue":"={{ $json.output }}","rightValue":"https://meet.google.com","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Avisa grupo"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2740,280],"id":"d1970829-f7bd-48e3-ad2e-e741ba9e2cf0","name":"Switch2"},{"parameters":{"resource":"messages-api","instanceName":"caio","remoteJid":"={{ $('Vari√°veis').item.json.telefone }}","messageText":"={{ $json.output }}","options_message":{"delay":1200,"linkPreview":false}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[3940,700],"id":"6f70e24c-d735-4615-9d5a-643ca495e19d","name":"Evolution API"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[3740,180],"id":"733c39bd-9ee7-4ce7-8fd3-4a6b3de839f1","name":"Merge1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"defac08a-6745-422b-bb05-90da9f47d91b","leftValue":"={{ $('Busca Telefone').last().json.values() }}","rightValue":"","operator":{"type":"array","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3280,140],"id":"097dae0c-6e91-4d9b-a420-17511bcdf583","name":"If4"},{"parameters":{"content":"","height":380,"width":1180,"color":4},"type":"n8n-nodes-base.stickyNote","position":[3080,0],"typeVersion":1,"id":"8a836e87-f2f8-4829-ba6f-e2576e4363f1","name":"Sticky Note54"},{"parameters":{"content":"# Cadastra Chat Supabase","height":80,"width":450,"color":5},"id":"36bfc22d-58e4-4e47-92e0-606e68832f6a","name":"Sticky Note55","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3100,20]},{"parameters":{"resource":"messages-api","instanceName":"caio","remoteJid":"={{ $('Vari√°veis').item.json.telefone }}","messageText":"={{ $json.output }}","options_message":{"delay":1}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[3300,500],"id":"eb180fe5-6a2e-4052-84e8-fadd4ba17661","name":"Evolution API5"},{"parameters":{"operation":"get","tableId":"chats","filters":{"conditions":[{"keyName":"phone","keyValue":"={{ $('Vari√°veis').item.json.telefone }}"},{"keyName":"app","keyValue":"terapeuta"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3140,140],"id":"8a19d675-d630-4006-a8f9-4b671bd128bb","name":"Busca Telefone","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"tableId":"chats","fieldsUi":{"fieldValues":[{"fieldId":"phone","fieldValue":"={{ $('Vari√°veis').item.json.telefone }}"},{"fieldId":"updated_at","fieldValue":"={{ $now}}"},{"fieldId":"conversation_id","fieldValue":"={{ $('Code1').item.json.sessionId }}"},{"fieldId":"app","fieldValue":"terapeuta"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3520,80],"id":"23679ac5-ea5c-44b4-b142-4f8adb66508c","name":"Adiciona CHAT supabase"},{"parameters":{"operation":"update","tableId":"chats","filters":{"conditions":[{"keyName":"phone","condition":"eq","keyValue":"={{ $('Vari√°veis').item.json.telefone }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"updated_at","fieldValue":"={{ $now }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3520,240],"id":"b13f1337-0831-47f3-8c0d-d82981cea6fc","name":"Atualiza CHAT Supabase","alwaysOutputData":true},{"parameters":{"tableId":"chat_messages","fieldsUi":{"fieldValues":[{"fieldId":"phone","fieldValue":"={{ $json.phone }}"},{"fieldId":"conversation_id","fieldValue":"={{ $json.phone }}"},{"fieldId":"bot_message","fieldValue":"={{ $('Atendente').item.json.output }}"},{"fieldId":"user_message","fieldValue":"={{ $json.phone }}"},{"fieldId":"message_type","fieldValue":"={{ $('dados_para_atendimento_humano1').item.json.message.content_type }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3920,180],"id":"82edee89-a235-4809-89db-5e29555c7472","name":"Cria Hist√≥rico Supabase"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7c4cdb12-9452-42a6-a39a-c268bd38dce1","leftValue":"={{ $json.output.lenght }}","rightValue":90,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3120,600],"id":"162e116c-e4ae-46f3-a043-aca937144db0","name":"Menos que 240 Caracteres"},{"parameters":{"fieldToSplitOut":"output.messages","options":{"destinationFieldName":"output"}},"id":"c361e57e-3e2b-407b-9273-c77af68f20df","name":"Split de Mensagem","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[3560,680]},{"parameters":{"amount":0.5},"id":"821f4d67-031b-4b5e-828d-306aae8857a5","name":"1 segundo","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[4080,700],"webhookId":"516863dc-34d1-4d39-8eb3-16b13abe1c40"},{"parameters":{"content":"","height":440,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-2220,180],"typeVersion":1,"id":"d0985e61-2cf4-4e34-bfcf-3f8a0b4920d3","name":"Sticky Note32"},{"parameters":{"content":"# Webhook","height":80,"width":196,"color":5},"id":"27d5ae31-a3c1-4897-a01c-97c4ac2b85b8","name":"Sticky Note67","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2200,200]},{"parameters":{"operation":"delete","key":"={{ $('Code1').item.json.sessionId }}"},"id":"ecbaea30-53ad-4dc0-ad24-c419cab3e651","name":"Delete Memory","type":"n8n-nodes-base.redis","typeVersion":1,"position":[4080,180],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"get","tableId":"dados_cliente","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,360],"id":"af8b986a-3cc6-4824-9f89-6d2e94c20dfb","name":"Supabase","alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4a6d9aac-8565-4c58-abe3-8741393a5535","leftValue":"={{ $json.telefone }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-540,360],"id":"9dc8a382-5bad-4c6c-973e-ab564cad95d8","name":"If1"},{"parameters":{"action":"generate"},"type":"n8n-nodes-base.crypto","typeVersion":1,"position":[-420,460],"id":"21c7fb6c-8410-42d8-b98e-753593b4e77b","name":"Gerar sessionID"},{"parameters":{"tableId":"dados_cliente","fieldsUi":{"fieldValues":[{"fieldId":"sessionid","fieldValue":"={{ $json.data }}"},{"fieldId":"telefone","fieldValue":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-280,460],"id":"4cdfa102-30fe-4904-89bb-8bc5553e9520","name":"Supabase1"},{"parameters":{"content":"","height":620,"width":560,"color":4},"type":"n8n-nodes-base.stickyNote","position":[900,0],"typeVersion":1,"id":"4ca62b65-bda5-4b49-9782-8101f74372d5","name":"Sticky Note17"},{"parameters":{"content":"","height":620,"width":880,"color":4},"type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1,"id":"46f219b1-162d-44e6-a827-a0f8ae0ac1fe","name":"Sticky Note20"},{"parameters":{"jsCode":"// Obt√©m os valores dos n√≥s anteriores\nconst sessionid1 = $input.item.json.data;  // Do n√≥ \"Gerar sessionID\"\nconst sessionid2 = $input.item.json.sessionid;  // Do n√≥ \"Supabase\"\n\n// Retorna apenas o que existir, chamando sempre de \"sessionId\"\nreturn [{ sessionId: sessionid1 || sessionid2 || null }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,300],"id":"f06f7a8f-7c4c-4abd-957b-9d4bfd8671e8","name":"Code1"},{"parameters":{"operation":"formatDate","date":"={{ $now }}","format":"custom","customFormat":"dd-MM-yyyy","options":{}},"type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-920,360],"id":"8bfe0fff-8b45-4402-9955-0fc796be8b4c","name":"Date & Time1"},{"parameters":{"operation":"toBinary","sourceProperty":"data","options":{"fileName":"file.png","mimeType":"image/png"}},"id":"18907be8-3365-43ad-94fc-9971248ad738","name":"Convert to File1","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[200,460]},{"parameters":{"assignments":{"assignments":[{"id":"3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655","name":"data","value":"={{ $('Webhook EVO').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"id":"7722036f-b113-4bfc-a558-2c36e5e0ad8b","name":"Edit Fields3","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[60,460]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"ade56c50-1520-4760-8df5-e99617d6d3ad","leftValue":"={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"8f4be11f-3b9c-463d-8f51-70719e77219e","name":"If3","type":"n8n-nodes-base.if","typeVersion":2,"position":[500,460]},{"parameters":{"operation":"push","list":"={{ $('Code1').item.json.sessionId }}","messageData":"={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"message\"][\"imageMessage\"][\"caption\"] }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}","tail":true},"id":"f43f6bab-6025-4069-afa4-d60ca6b562c5","name":"Redis4","type":"n8n-nodes-base.redis","typeVersion":1,"position":[760,480],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"push","list":"={{ $('Code1').item.json.sessionId }}","messageData":"={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}","tail":true},"id":"5b2dc7e8-9e3a-4757-8719-1a4443e553e8","name":"Redis5","type":"n8n-nodes-base.redis","typeVersion":1,"position":[760,340],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"52aaf749-fe4f-44e4-880e-15b2bfc027f1","leftValue":"={{ $('Webhook EVO').item.json.body.data.messageType }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"e514e613-fd6a-48bd-b0ae-bae2448c810e","leftValue":"={{ $('Webhook EVO').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook EVO').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"c0e434dd-1268-421d-b81b-3a5e90ed9550","leftValue":"={{ $('Webhook EVO').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"}]},"options":{}},"id":"67b27d34-17e1-4a6f-853b-f2b50778e467","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3,"position":[20,220]},{"parameters":{"content":"# Mensagem Picotada","height":80,"width":396,"color":5},"id":"21baa52e-ff4a-4fc1-856c-97eb96647328","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[980,40]},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"Resumo curto da imagem. Responda sem acento, sem hifens","inputType":"base64","options":{}},"id":"cfb749ef-e007-4a00-a328-58555449cf4b","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[360,460],"credentials":{"openAiApi":{"id":"rVdjfDowKjs3OG2m","name":"OpenAi - TECHPULSE"}}},{"parameters":{"operation":"push","list":"={{ $('Code1').item.json.sessionId }}","messageData":"={{ $('Webhook EVO').item.json.body.data.message.conversation }}","tail":true},"id":"3960f2f1-9c01-46c2-afed-06a23b46b2e3","name":"Text Memory1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[760,20],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"push","list":"={{ $('Code1').item.json.sessionId }}","messageData":"={{ $json.text }}","tail":true},"id":"0c0c3d9c-8536-46a5-b414-91289dc605f6","name":"Audio Memory1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[760,180],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"amount":0.5},"id":"0ec19999-0121-49a9-859c-f3a7543dbf64","name":"Wait3","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1100,260],"webhookId":"3334ebf2-b9d8-4814-bb5d-bc6340047fae"},{"parameters":{"operation":"get","key":"={{ $('Code1').item.json.sessionId }}","options":{}},"id":"cb7af89c-050e-4505-b8d1-6e3b938ef1cd","name":"Get Memory 1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[940,260],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"get","key":"={{ $('Code1').item.json.sessionId }}","options":{}},"id":"ee91177e-f99a-4b58-b5d4-95d93f188663","name":"Get Memory 2","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1260,260],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"get","tableId":"dados_cliente","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $json.telefone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-320,300],"id":"aff35bb7-5525-4fd0-8bc6-8bc35f6e2cce","name":"Get Dados"},{"parameters":{"assignments":{"assignments":[{"id":"8d88c137-383f-4307-b3cc-1f6a560ea67b","name":"telefone","value":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"7e2f520e-4952-425b-82ca-792cc46680d4","name":"mensagem","value":"={{ $('Webhook EVO').item.json.body.data.message.conversation }}{{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage.text }}","type":"string"},{"id":"de1388b1-a6e4-42df-a6a5-7e9b4594f97d","name":"body.event","value":"={{ $('Webhook EVO').item.json.body.event }}","type":"string"}]},"options":{}},"id":"b551a1dc-4514-4c33-af16-cdde3bcb0cd5","name":"Vari√°veis","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1080,360]},{"parameters":{"assignments":{"assignments":[{"id":"8f16b1bf-1a3e-4029-8d7a-1bccb919ee43","name":"message.message_id","value":"={{ $('Webhook EVO').item.json.body.data.key.id || '' }}","type":"string"},{"id":"11800d83-ecca-4f9c-a878-a2419db0c8e9","name":"message.chat_id","value":"={{ $('Webhook EVO').item.json.body.data.key.remoteJid || '' }}","type":"string"},{"id":"c33f9527-e661-49e5-8e5e-64f3b430928a","name":"message.content_type","value":"={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage ? 'image' : '' }}","type":"string"},{"id":"06eba1c9-cff0-4f68-b6da-6bb0092466b7","name":"message.content","value":"={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}","type":"string"},{"id":"b97f1af3-5361-46fc-9303-d644921231d8","name":"message.timestamp","value":"={{ $('Webhook EVO').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}","type":"string"},{"id":"dc3dc59c-90a3-4a45-bea2-de092c91083b","name":"message.content_url","value":"={{ $('Webhook EVO').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.url || '' }}","type":"string"},{"id":"8b01a818-a456-476e-bace-adefe2f04eb4","name":"message.event","value":"={{ $('Webhook EVO').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}","type":"string"},{"id":"b2f1f6b5-292f-4695-9e41-be200c6d7053","name":"instance.name","value":"={{ $json.body.instance }}","type":"string"},{"id":"572fcce5-8a26-4e8f-a48a-ef0bee569dcd","name":"instance.apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"e90043db-657b-461c-b040-2d6089abfbdb","name":"instance.server_url","value":"={{ $json.body.server_url }}","type":"string"}]},"options":{}},"id":"2d394f47-f7e9-4d2c-a764-0155c9c32eec","name":"dados_para_atendimento_humano1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1860,360]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.block }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ia Ativa"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3ef0e01c-cc14-4663-bb4d-2905b350c3ab","leftValue":"={{ $json.block }}","rightValue":"true","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ia Desativada"}]},"options":{}},"id":"4102cb29-0331-4d4d-ae1d-34f6b13e020e","name":"Switch Block","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-1320,460]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.message.event }}","rightValue":"outcoming","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"outcoming"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"d7b42536-638f-4128-b51b-6aa913e9d9bc","leftValue":"={{ $json.message.event }}","rightValue":"incoming","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"incoming"}]},"options":{}},"id":"fac6c1c1-e4bf-471e-8e96-22998c18bcec","name":"Switch6","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-1680,360]},{"parameters":{"operation":"set","key":"={{ $json.message.chat_id }}_block","value":"true","keyType":"string","expire":true,"ttl":1},"id":"b4666088-6b62-4e95-bcdb-f00330d8ce7e","name":"PARA IA","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-1480,300],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"get","propertyName":"block","key":"={{ $json.message.chat_id }}_block","options":{}},"id":"092914b2-a91b-47f5-b4bc-fa7f171a9c6d","name":"Verificar Atendimento","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-1480,460],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan - 03"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data","options":{"fileName":"file.ogg","mimeType":"application/ogg"}},"id":"94b19ce3-18f3-4ee7-845d-551fbcd46267","name":"Convert to File","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[400,260]},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"dbeb7eab-9a0d-4f2d-94b8-351d98fb1ffd","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[580,260],"credentials":{"openAiApi":{"id":"rVdjfDowKjs3OG2m","name":"OpenAi - TECHPULSE"}}},{"parameters":{"content":"# Pausa para Atendimento Humano","height":80,"width":656,"color":5},"id":"2890eefa-543f-4fd4-9db5-bee2eb5024a0","name":"Sticky Note46","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1920,200]},{"parameters":{"content":"# MSG Texto | Voz | √Åudio","height":80,"width":476,"color":5},"id":"647bcf9c-78df-4e2c-8ffe-27b6ef923e49","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[20,20]},{"parameters":{"assignments":{"assignments":[{"id":"3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655","name":"data","value":"={{ $('Webhook EVO').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"id":"76ecac37-be0a-471f-b873-ee65b2f8188f","name":"Edit Fields1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[240,260]},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[1920,420],"id":"bef997a3-a517-438f-bfaf-9c05a1599f3b","name":"Think"},{"parameters":{"operation":"update","calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id","__regex":"(^[a-zA-Z0-9.!#$%&‚Äô*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","updateFields":{"description":"={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","summary":"={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"}},"id":"edab5ae9-c8fc-481b-b6ca-cfe3885bf063","name":"UpdateEvent","type":"n8n-nodes-base.googleCalendarTool","position":[2340,420],"typeVersion":1.3},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id","__regex":"(^[a-zA-Z0-9.!#$%&‚Äô*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"},"eventId":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}","options":{}},"id":"3689dbc0-aee1-4aa6-a193-05d9ac10fb8b","name":"DeleteEvent","type":"n8n-nodes-base.googleCalendarTool","position":[2480,420],"typeVersion":1.3},{"parameters":{"calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id"},"start":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}","end":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}","additionalFields":{"description":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `The event description`, 'string') }}","summary":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', `nome do cliente e a modalidade se for futevolei abreviar para Fut, se for beach tennis abreviar para Beach, dura√ß√£o da loca√ß√£o neste fornato 1h, 2h. Exemplo final: Nome | 1h | Modalidade`, 'string') }}"}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2200,420],"id":"bac60283-f927-48fa-90c2-c31466851f84","name":"CreateEvent"},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}","mode":"id","__regex":"(^[a-zA-Z0-9.!#$%&‚Äô*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}","timeMin":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}","timeMax":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.3,"position":[2060,420],"id":"4d98f1db-4300-47c1-8e5c-d6f691e62a82","name":"GetEvent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1620,420],"id":"28336ff4-b122-4f53-88eb-7fa8411b0d39","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"rVdjfDowKjs3OG2m","name":"OpenAi - TECHPULSE"}}},{"parameters":{"content":"# Consulta | Cadastra Cliente","height":80,"width":490,"color":5},"id":"b7aca179-538a-404a-b23e-9273446d3d92","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-740,200]}],"connections":{"OpenAI3":{"ai_languageModel":[[{"node":"Parser  Chain","type":"ai_languageModel","index":0}]]},"Loop Over Items3":{"main":[[],[{"node":"Evolution API","type":"main","index":0}]]},"OutputParser1":{"ai_outputParser":[[{"node":"Parser  Chain","type":"ai_outputParser","index":0}]]},"Parser  Chain":{"main":[[{"node":"Split de Mensagem","type":"main","index":0}]]},"Switch3":{"main":[[{"node":"Menos que 240 Caracteres","type":"main","index":0}],[{"node":"Menos que 240 Caracteres","type":"main","index":0}],[{"node":"Menos que 240 Caracteres","type":"main","index":0}],[{"node":"Menos que 240 Caracteres","type":"main","index":0}]]},"Atendente":{"main":[[{"node":"Busca Telefone","type":"main","index":0},{"node":"Switch2","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Atendente","type":"ai_memory","index":0}]]},"Webhook EVO":{"main":[[{"node":"dados_para_atendimento_humano1","type":"main","index":0}]]},"Switch2":{"main":[[{"node":"Switch3","type":"main","index":0}]]},"Evolution API":{"main":[[{"node":"1 segundo","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Cria Hist√≥rico Supabase","type":"main","index":0}]]},"If4":{"main":[[{"node":"Adiciona CHAT supabase","type":"main","index":0}],[{"node":"Atualiza CHAT Supabase","type":"main","index":0}]]},"Busca Telefone":{"main":[[{"node":"If4","type":"main","index":0}]]},"Adiciona CHAT supabase":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Atualiza CHAT Supabase":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Menos que 240 Caracteres":{"main":[[{"node":"Evolution API5","type":"main","index":0}],[{"node":"Parser  Chain","type":"main","index":0}]]},"Split de Mensagem":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"1 segundo":{"main":[[{"node":"Loop Over Items3","type":"main","index":0}]]},"Cria Hist√≥rico Supabase":{"main":[[{"node":"Delete Memory","type":"main","index":0}]]},"Supabase":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Get Dados","type":"main","index":0}],[{"node":"Gerar sessionID","type":"main","index":0}]]},"Gerar sessionID":{"main":[[{"node":"Supabase1","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Date & Time1":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"If3":{"main":[[{"node":"Redis5","type":"main","index":0}],[{"node":"Redis4","type":"main","index":0}]]},"Redis4":{"main":[[{"node":"Get Memory 1","type":"main","index":0}]]},"Redis5":{"main":[[{"node":"Get Memory 1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Text Memory1","type":"main","index":0}],[{"node":"Text Memory1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}],[{"node":"Edit Fields3","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"If3","type":"main","index":0}]]},"Text Memory1":{"main":[[{"node":"Get Memory 1","type":"main","index":0}]]},"Audio Memory1":{"main":[[{"node":"Get Memory 1","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Get Memory 2","type":"main","index":0}]]},"Get Memory 1":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"Get Memory 2":{"main":[[{"node":"Atendente","type":"main","index":0}]]},"Get Dados":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Vari√°veis":{"main":[[{"node":"Date & Time1","type":"main","index":0}]]},"dados_para_atendimento_humano1":{"main":[[{"node":"Switch6","type":"main","index":0}]]},"Switch Block":{"main":[[{"node":"Vari√°veis","type":"main","index":0}],[{"node":"Vari√°veis","type":"main","index":0}]]},"Switch6":{"main":[[{"node":"PARA IA","type":"main","index":0}],[{"node":"Verificar Atendimento","type":"main","index":0}]]},"Verificar Atendimento":{"main":[[{"node":"Switch Block","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"Audio Memory1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Think":{"ai_tool":[[{"node":"Atendente","type":"ai_tool","index":0}]]},"UpdateEvent":{"ai_tool":[[{"node":"Atendente","type":"ai_tool","index":0}]]},"DeleteEvent":{"ai_tool":[[{"node":"Atendente","type":"ai_tool","index":0}]]},"CreateEvent":{"ai_tool":[[{"node":"Atendente","type":"ai_tool","index":0}]]},"GetEvent":{"ai_tool":[[{"node":"Atendente","type":"ai_tool","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Atendente","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Webhook EVO":[{"json":{"headers":{"host":"webhook.depositointeligente.com.br","user-agent":"axios/1.7.9","content-length":"965","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"webhook.depositointeligente.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"acf5800ee695","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"caio","data":{"key":{"remoteJid":"553188037361@s.whatsapp.net","fromMe":false,"id":"3EB05C17B74E36C2AC7A77"},"pushName":"Eng Civil Gilson Souza","status":"DELIVERY_ACK","message":{"conversation":"nova interacao","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"EYgKrabBA3hA6A==","senderTimestamp":"1747938146","senderAccountType":"E2EE","receiverAccountType":"E2EE","recipientKeyHash":"W6x1MTMmoTAvMQ==","recipientTimestamp":"1747830695"},"deviceListMetadataVersion":2,"messageSecret":"9jZxkPiHp8RkD37tPClky5nhyyRHHMMWwJM163bZexQ="}},"messageType":"conversation","messageTimestamp":1748888680,"instanceId":"7770b70d-f865-4fc9-a498-b736f9ffbaa6","source":"web"},"destination":"https://webhook.depositointeligente.com.br/webhook/agenda","date_time":"2025-06-02T15:24:41.176Z","sender":"556184460318@s.whatsapp.net","server_url":"https://api.depositointeligente.com.br","apikey":"2C5AF781901D-48B3-846D-370A170A660F"},"webhookUrl":"https://webhook.depositointeligente.com.br/webhook/agenda","executionMode":"production"}}]},"versionId":"5ab61cce-04f2-4bc7-94ea-f4315183683f","triggerCount":0,"tags":[{"createdAt":"2025-05-27T19:09:01.181Z","updatedAt":"2025-05-27T19:09:01.181Z","id":"gEfDb97AjPtkX4Dg","name":"Projeto"}]}