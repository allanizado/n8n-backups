{"createdAt":"2025-05-14T16:55:20.799Z","updatedAt":"2025-05-14T17:47:44.052Z","id":"pjQVyOdQ0h6AD421","name":"Delivery Atendimento","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{"temperature":0.2}},"id":"5dfe45c9-b433-4c91-a078-fd0d36a79597","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2840,800],"credentials":{"openAiApi":{"id":"y6EOm7GTWxcYjDT6","name":"OpenAi Allan"}}},{"parameters":{"content":"","height":654,"width":1359,"color":6},"id":"bb4a0ba3-7562-4e44-a062-75ac7e476279","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1480,380]},{"parameters":{},"id":"a914d398-43fd-4e9b-b733-6658fe89d4f6","name":"NoOp.","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2360,520]},{"parameters":{"content":"#### Agrupa messages subsequentes do usuÃ¡rio","height":80,"width":361.5468993739327,"color":4},"id":"6d2ad451-436b-439d-bca1-dca45e0cdbee","name":"Sticky Note14","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2060,400]},{"parameters":{"content":"Configure seu Prompt","height":223.25452635785376,"width":180.90155202154455,"color":2},"id":"e9df122e-bd16-468f-961b-374064f8960b","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-160,520]},{"parameters":{},"id":"29e204c3-0ae0-405d-b655-e04b72e4ff9e","name":"NoOp.4","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-120,780]},{"parameters":{"amount":"={{ $('camposIniciais').item.json.app.debouncerTime }}"},"id":"fd5f1024-d88f-4dbe-b2f2-a046c01d5ae4","name":"Wait","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2340,800],"webhookId":"c48e8179-8f87-4fec-a432-470a6112c060"},{"parameters":{"assignments":{"assignments":[{"id":"b7158aa0-84e0-44b1-8629-bf23fb4c0766","name":"=messages","value":"={{ $json.message.map(buffer => JSON.parse(buffer).message).join('\\n') }}\n{{ (() => { \n    try {\n        return $('camposIniciais').item.json.content.quoted || \"\"; \n    } catch (error) {\n        return \"\";\n    } \n})() }}\n","type":"string"},{"id":"0c4c3b74-297a-4cf2-b2b8-0feefad328ec","name":"sessionid","value":"={{ $('getClient').item.json.sessionID }}","type":"string"}]},"options":{}},"id":"4c7e16b7-3aac-4aa7-9982-6443d1853d77","name":"messages","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2680,680]},{"parameters":{"operation":"push","list":"={{ $('camposIniciais').item.json.meta.telefoneCliente.toString() }}","messageData":"={{ JSON.stringify({ \n    \"message\": $('camposIniciais').item.json.content.mensagem, \n    \"timestamp\": $now,\n    \"message_id\": $('camposIniciais').item.json.content.idMensagem\n}) }}","tail":true},"id":"3c80f606-1a9a-48bf-a487-2cf73edcdc45","name":"empilhaTexto","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1740,680],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan Delivery - 03"}}},{"parameters":{"operation":"get","propertyName":"message","key":"={{ $('camposIniciais').item.json.meta.telefoneCliente.toString() }}","options":{}},"id":"0e9d3f22-9315-49be-bd6d-6b1c815ca67a","name":"Obtem","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1940,680],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan Delivery - 03"}}},{"parameters":{"operation":"delete","key":"={{ $('camposIniciais').item.json.meta.telefoneCliente.toString() }}"},"id":"3525e5ea-0a02-43e5-a0ec-855c733a8d6f","name":"Deleta","type":"n8n-nodes-base.redis","typeVersion":1,"position":[2520,680],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan Delivery - 03"}}},{"parameters":{"assignments":{"assignments":[{"id":"aa4d5d29-e6f1-4bce-b5ff-4575b553a077","name":"systemMessageAgente","value":"=<!-- Identidade do Agente -->\n<identity>\n  VocÃª Ã© a Tais, Assistente de Atendimento da hamburgueria **Bucaneiro Burger**. Sua funÃ§Ã£o Ã© interpretar as mensagens enviadas pelos clientes para oferecer um atendimento rÃ¡pido e eficiente, garantindo uma Ã³tima experiÃªncia.  \n  Utilize a ferramenta **cardapio_bucaneiro** sempre que precisar consultar o cardÃ¡pio ou os preÃ§os dos itens. Mas nunca envie o cardÃ¡pio completo para o cliente. Apenas o pdf do cardÃ¡pio.\n  Utilize a ferramenta **enviar_cardapio** sempre no inÃ­cio da conversa ou sempre que o cliente solicitar o cardÃ¡pio\n</identity>\n\n\n<!-- Papel e Responsabilidades -->\n<role>\n  Assistente especializada em:\n  - Interpretar mensagens para identificar as necessidades do cliente.\n  - Ative ``enviar_cardapioÂ´Â´ para enviar o cardÃ¡pio na primeira interaÃ§Ã£o com o cliente.\n  - Consultar o cardÃ¡pio e preÃ§os utilizando a ferramenta ``cardapio_bucaneiroÂ´Â´.\n  - Ative ``atualiza_enderecoÂ´Â´ para atualizar o endereÃ§o informado pelo cliente.\n  - Calcular e informar o valor total do pedido, incluindo itens previamente confirmados.\n  - Registrar o endereÃ§o de entrega.\n  - Confirmar a forma de pagamento.\n  - Fornecer estimativas de tempo de entrega.\n  - Sugerir itens adicionais, como batatas fritas e bebidas, caso nÃ£o estejam incluÃ­dos no pedido.\n  Toda interaÃ§Ã£o deve ser clara, objetiva e atenciosa.  \n</role>\n\n<!-- Tratamento de Erros -->\n<errorHandling>\n  Caso nÃ£o seja possÃ­vel acessar a ferramenta cardapio_bucaneiro**, informe ao cliente:  \n  \"Desculpe, estamos com problemas para acessar o cardÃ¡pio agora. VocÃª gostaria de tentar novamente mais tarde?\"  \n</errorHandling>\n\n<!-- Capacidades -->\n<capabilities>\n  <textResponse>Responder de forma clara e natural a mensagens de texto.</textResponse>\n  <menuQuery>Consultar cardÃ¡pio e preÃ§os com a ferramenta **cardapio_bucaneiro**.</menuQuery>\n  <orderCalculation>Calcular o valor total do pedido com base nos preÃ§os consultados, incluindo itens jÃ¡ confirmados.</orderCalculation>\n  <addressCollection>Coletar e confirmar o endereÃ§o de entrega.</addressCollection>\n  <paymentConfirmation>Confirmar a forma de pagamento.</paymentConfirmation>\n  <itemSuggestion>Sugerir itens adicionais, como batatas fritas e bebidas, caso nÃ£o estejam incluÃ­dos no pedido.</itemSuggestion>\n</capabilities>\n\n<!-- Fluxo de Atendimento -->\n<steps>\n  <step number=\"1\">\n    Interprete a mensagem do cliente para identificar se ele estÃ¡:\n    - Solicitando informaÃ§Ãµes sobre o cardÃ¡pio.\n    - Fazendo um pedido especÃ­fico.\n    - Perguntando sobre a entrega ou forma de pagamento.\n    - Sempre inicie a primeira interaÃ§Ã£o ative a ferramenta ``enviar_cardapioÂ´Â´ e mande a mensagem inicial dessa forma: \n    \"OlÃ¡! ğŸ´â€â˜ ï¸ Bem-vindo ao Bucaneiro Burger!\n    Aqui estÃ¡ nosso cardÃ¡pio. Estamos prontos para preparar o melhor hambÃºrguer para vocÃª!ğŸ”\"\n    - Caso o cliente esteja fazendo um pedido especÃ­fico:  \n      Registre o item no pedido e prossiga com a oferta de complementos.\n  </step>\n\n  <step number=\"2\">\n    ApÃ³s o cliente informar o pedido, ative a ferramenta ``cardapio_bucaneiroÂ´Â´ para consultar os preÃ§os de cada item.  \n    - Registre o item no resumo do pedido.  \n    - Verifique se o pedido inclui batatas fritas ou bebidas. Caso contrÃ¡rio, sugira os complementos:  \n      - Se o cliente nÃ£o mencionou batatas fritas:  \n        \"Gostaria de incluir uma porÃ§Ã£o de batata frita ao seu pedido? Temos opÃ§Ãµes deliciosas, como a Batata Frita Simples por R$ 13,90 ou a Batata Frita com Cheddar e Bacon por R$ 18,90.\"  \n      - Se o cliente nÃ£o mencionou bebidas:  \n        \"Quer incluir algo para beber? Temos refrigerantes, sucos e muito mais!\"  \n\n    - Informe o valor total atualizado do pedido incluindo todos os itens:  \n      \"VocÃª pediu:  \n      - **[Itens e preÃ§os do pedido detalhados atÃ© agora]**  \n      O valor total do seu pedido Ã©: **R$ [valor total calculado]**. EstÃ¡ tudo certo ou gostaria de adicionar/remover algo?\"\n  </step>\n\n  <step number=\"3\">\n    Caso o cliente adicione novos itens, **atualize o pedido mantendo os itens previamente confirmados** e informe novamente o resumo atualizado:  \n    - \"VocÃª pediu:  \n      - **[Itens confirmados atÃ© agora e novos itens adicionados]**  \n      O valor total atualizado Ã©: **R$ [valor total recalculado]**.\"\n  </step>\n\n  <step number=\"4\">\n    Pergunte o endereÃ§o de entrega:  \n    \"Agora, por favor, me informe o endereÃ§o completo para a entrega.\"\n    - Ative ``atualiza_enderecoÂ´Â´ para cadastrar o endereÃ§o ou atualizar se for preciso  \n    - Caso o cliente jÃ¡ tenha feito pedidos antes:  \n      \"O endereÃ§o cadastrado Ã© **[EndereÃ§o Salvo]**. EstÃ¡ correto ou deseja atualizÃ¡-lo?\"\n  </step>\n\n  <step number=\"5\">\n    Confirme a forma de pagamento:  \n    \"Qual serÃ¡ a forma de pagamento?  \n    - Pix  \n    - CartÃ£o de crÃ©dito/dÃ©bito na entrega  \n    - Dinheiro (se for o caso, pode informar o troco necessÃ¡rio)\"\n  </step>\n\n  <step number=\"6\">\n    ApÃ³s coletar todas as informaÃ§Ãµes, confirme o pedido completo:  \n    \"EntÃ£o ficou assim:  \n    - Pedido: **[Itens do Pedido e preÃ§os detalhados]**  \n    - Valor Total: **R$ [valor total calculado]**  \n    - EndereÃ§o: **[EndereÃ§o Informado]**  \n    - Forma de pagamento: **[Forma de Pagamento]**  \n    EstÃ¡ tudo correto?\"\n  </step>\n\n  <step number=\"7\">\n    Finalize o pedido, informe o tempo estimado de entrega e registre no sistema:  \n    \"Pedido confirmado com sucesso! O prazo estimado para entrega Ã© de **[Tempo Estimado]** minutos. Estamos preparando tudo com carinho!\"\n  </step>\n\n  <step number=\"8\">\n    Pergunte ao cliente se ele tem mais alguma dÃºvida ou deseja adicionar algo:  \n    \"Posso ajudar em mais alguma coisa ou adicionar algo ao seu pedido?\"\n  </step>\n\n  <step number=\"9\">\n    Finalize a conversa com simpatia:  \n    \"Obrigada por escolher o **Bucaneiro Burger**! Estamos sempre Ã  disposiÃ§Ã£o. Tenha um Ã³timo dia!\"\n  </step>\n</steps>\n\n<!-- Regra de Continuidade -->\n<continuityRule>\n  Nunca envie o cardÃ¡pio completo.  \n  Quando o cliente solicitar o cardÃ¡pio apenas envie o link do cardÃ¡pio.  \n  Sempre interprete a mensagem recebida para determinar qual step seguir no fluxo de atendimento.  \n  Sempre inclua no resumo final **todos os itens previamente confirmados pelo cliente**.  \n  Caso a mensagem do cliente nÃ£o corresponda a nenhum step, solicite mais detalhes para continuar:  \n  \"VocÃª pode me explicar melhor para que eu possa te ajudar da melhor forma possÃ­vel?\"  \n</continuityRule>","type":"string"},{"id":"9567d6ed-399e-4fe6-9e6a-48a5d9eba008","name":"InputAI","value":"={{ $json?.tipoMensagem || $('camposIniciais').item.json.content.tipoMensagem || \" \" }}","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"0c2b4ed7-e445-4f5c-83e2-804c611df136","name":"Prompts","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-120,580],"alwaysOutputData":false},{"parameters":{"operation":"push","list":"={{ $('camposIniciais').item.json.meta.telefoneCliente.toString() }}","messageData":"={{ JSON.stringify({ \n    \"message\": $('Webhook').item.json.body.data.message.speechToText, \n    \"timestamp\": $now,\n    \"message_id\": $('camposIniciais').item.json.content.idMensagem\n}) }}","tail":true},"id":"3fed2110-445a-45c2-9242-9fd16006168c","name":"empilhaÃudio","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1740,860],"credentials":{"redis":{"id":"C114rcYoXHiBkZid","name":"Redis Allan Delivery - 03"}}},{"parameters":{"assignments":{"assignments":[{"id":"f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379","name":"meta.telefoneCliente","value":"={{ \n  $json.body?.conversation?.contact_inbox?.contact_id || \n  $json.body?.data?.key?.remoteJid || \n  null \n}}","type":"string"},{"id":"a019046c-3b5a-4fd0-a497-de55cb2178ea","name":"meta.telefoneEmpresa","value":"={{ $json.body.sender }}","type":"string"},{"id":"dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5","name":"meta.nomeCliente","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"01238a36-6907-4aec-ab21-26345ed5fc96","name":"whatsapp.evo.nomeInstancia","value":"={{ $json.body.instance || null }}","type":"string"},{"id":"81612acf-1b66-4c8e-82e4-ce8c77b31334","name":"content.mensagem","value":"={{ \n  $json.body?.content || \n\n  $json.body?.data?.message?.extendedTextMessage?.text || \n  $json.body?.data?.message?.imageMessage?.caption || \n  $json.body?.data?.message?.conversation || \n  $json?.message?.text || \n  $json?.message?.caption || \n  null \n}}","type":"string"},{"id":"cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7","name":"content.tipoMensagem","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"2dfc64f4-b222-4ea7-b095-fdd96d9fcb95","name":"content.idMensagem","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"9d947263-3b68-4c63-88ba-ef1b9de22571","name":"clinica.nomeEmpresa","value":"Bucaneiro Burger","type":"string"},{"id":"076ad2d4-b8ea-440f-9c02-f7e8417a984d","name":"whatsapp.evo.apikey","value":"={{ $json.body.apikey || null }}","type":"string"},{"id":"0c237725-0428-4f1d-bddf-41bd289b3168","name":"whatsapp.evo.server_url","value":"={{ $json.body.server_url || null }}","type":"string"},{"id":"255b9c45-7769-4d09-9c50-61dcdfb7c09d","name":"app.debouncerTime","value":"1","type":"string"},{"id":"196aeb96-5c33-4dd7-9a4f-6bd40765b7fb","name":"doc.id","value":"180d5XZCiNX9hibvGoazfZ5gyzfPP_8YJmNKEo0kMxEs","type":"string"},{"id":"fc7c5c8f-b505-4a43-ae07-51eea58d6f80","name":"linkPreview","value":false,"type":"boolean"},{"id":"e30bbf8c-d5da-4410-b875-8dfe4b301798","name":"Digitando","value":1800,"type":"number"},{"id":"c4f557bd-72f1-4507-8d9d-c2a590eea2b8","name":"content.quoted","value":"={{ $json.body.data.contextInfo.quotedMessage.conversation }}","type":"string"}]},"options":{}},"id":"eb3c6dd3-daf1-443f-a8bf-7593e5044204","name":"camposIniciais","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-320,680],"notesInFlow":true},{"parameters":{"operation":"get","tableId":"documents_delivery","filters":{"conditions":[{"keyName":"telefoneCliente","keyValue":"={{ $('camposIniciais').item.json.meta.telefoneCliente }}"}]}},"id":"83e789ba-ab46-4277-bcf1-8a0f1f96eef5","name":"getClient","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[380,680],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4e77cc7c-48f4-4cbe-94e7-6d211db67002","leftValue":"={{ $('getClient').item.json.telefoneCliente }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"8b9e45b8-dcd8-400f-b204-d00e267e2ecb","name":"If1","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[580,680]},{"parameters":{"tableId":"documents_delivery","fieldsUi":{"fieldValues":[{"fieldId":"nomeCliente","fieldValue":"={{ $('camposIniciais').item.json.meta.nomeCliente }}"},{"fieldId":"telefoneCliente","fieldValue":"={{ $('camposIniciais').item.json.meta.telefoneCliente }}"},{"fieldId":"idMensagem","fieldValue":"={{ $('camposIniciais').item.json.content.idMensagem }}"},{"fieldId":"sessionID","fieldValue":"={{ $json.data }}"}]}},"id":"c03a1456-06da-4d29-a2b5-0339c2b0456f","name":"CreateUser","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[960,820],"credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"action":"generate"},"id":"9df27158-2577-4ee6-87a6-b378d2d82c89","name":"GeraUUID","type":"n8n-nodes-base.crypto","typeVersion":1,"position":[780,820],"notesInFlow":false},{"parameters":{},"id":"9654490a-cda2-441c-9977-56c357a31deb","name":"Calculadora","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2960,800]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('messages').item.json.sessionid }}","contextWindowLength":10},"id":"6bba9ef1-0ed2-434b-ab73-586d0a2006da","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.1,"position":[3080,800],"credentials":{"postgres":{"id":"RmSFkHUs6pNL86eY","name":"Postgres Jessica"}}},{"parameters":{},"id":"fc783338-2010-45e8-82b6-807d01f2c8d5","name":"NOP1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1320,520]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b3c9b986-29a6-4418-a033-6422c387377f","leftValue":"={{ $('Webhook').item.json.body.data.key.fromMe}}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"id":"3eabb4e5-5ff3-4928-8883-979833665a20","name":"fromMe","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1100,660]},{"parameters":{"content":"### 1Âª Parte do workflow\n- Adiciona dados no node \"campos iniciais\"\n- Configura o prompt\n- Verifica cadastro de cliente no Supabase\n- Agrupa as mensagens\n- Agente de IA responde e utiliza as tools\n- Atualiza o cliente se necessÃ¡rio\n- Responde o cliente com mensagens Ãºnicas","height":223,"width":441,"color":4},"id":"e4a214e3-cd18-4883-b2f6-ef87a44f6289","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"content":"","height":634,"width":1210.1202692366064,"color":6},"id":"ceadd796-c68f-42a1-9829-2354112d904d","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-900,380]},{"parameters":{"content":"#### Credenciais e dados padrÃµes","height":80,"width":282,"color":4},"id":"c6d011a8-2e4a-45e9-8a05-04bad4849e03","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-600,380]},{"parameters":{"content":"Configure seus dados","height":223.25452635785376,"width":180.90155202154455,"color":2},"id":"a8a9b462-28e1-4525-a97b-7f1231431c31","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-360,620]},{"parameters":{"content":"","height":654,"width":1138.3054909499963,"color":6},"id":"fcf4b5d3-bf34-49c8-945d-c2f11e5e65d7","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[320,380]},{"parameters":{"content":"#### Cadastra usuÃ¡rio no **Supabase**","height":80,"width":282,"color":4},"id":"a1bbca41-919c-45e6-8832-ecc23043c846","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1160,400]},{"parameters":{"content":"","height":897,"width":1159,"color":6},"id":"7ea59d46-e45f-4f28-8d8d-d6fbc76198af","name":"Sticky Note11","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2860,380]},{"parameters":{"content":"#### O CÃ©rebro (Agente AI)","height":80,"width":202,"color":4},"id":"42f1352b-2c89-4921-a248-2b89e99b613c","name":"Sticky Note18","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3800,400]},{"parameters":{},"id":"08bf9ddd-2585-42da-a51f-a9b803d4df49","name":"When clicking â€˜Test workflowâ€™","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-620,20]},{"parameters":{"mode":"delete","deleteMode":"all"},"id":"9ca50e58-d704-48ca-8653-75fd8d66443f","name":"Chat Memory Manager","type":"@n8n/n8n-nodes-langchain.memoryManager","typeVersion":1.1,"position":[-360,20]},{"parameters":{"sessionIdType":"customKey","sessionKey":"=9516b290-944c-4c35-8c27-55cb3df2fe47","tableName":"n8n_chat_histories_agendamento","contextWindowLength":80},"id":"b59586e6-4628-4a80-af09-fba5f579b470","name":"Postgres Chat Memory1","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.1,"position":[-340,220],"credentials":{"postgres":{"id":"7BihdPSijog1ko5Q","name":"Postgres Allan - SUPA"}}},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"id":"99d5fe81-9387-4c91-92d0-262acf3ba5c0","name":"UnificaDados","type":"n8n-nodes-base.merge","typeVersion":3,"position":[80,680],"notesInFlow":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ \n  $json.message.length > 8 \n  ? $('camposIniciais').item.json.content.idMensagem\n  : JSON.parse($json.message.first()).message_id.toString().trim()\n}}","rightValue":"={{ $('camposIniciais').item.json.content.idMensagem.toString().trim() }}","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"nada a fazer"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2b9b7794-e8f6-45b5-8021-f59dbb747cb0","leftValue":"={{ JSON.parse($json.message.last()).timestamp }}","rightValue":"={{ $now.minus($('camposIniciais').item.json.app.debouncerTime, 'seconds') }}","operator":{"type":"dateTime","operation":"before"}}],"combinator":"and"},"renameOutput":true,"outputKey":"proceder"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"esperar"}},"id":"1b40059b-c52c-4608-a123-78ece1d94e0a","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2140,680]},{"parameters":{"descriptionType":"manual","toolDescription":"=Consulte sempre que precisar de informaÃ§Ãµes de pagamento, taxa de entrega, endereÃ§o e horÃ¡rio de funcionamento","operation":"get","documentURL":"180d5XZCiNX9hibvGoazfZ5gyzfPP_8YJmNKEo0kMxEs"},"id":"d2733d83-93cf-4f7b-a315-a5504e292da3","name":"informacoes_bucaneiro","type":"n8n-nodes-base.googleDocsTool","typeVersion":2,"position":[3220,800],"credentials":{"googleDocsOAuth2Api":{"id":"MLjJUGkxKVVfkc7y","name":"Google Docs allan"}}},{"parameters":{"method":"POST","url":"={{ $('camposIniciais').item.json.whatsapp.evo.server_url }}/message/sendText/{{ $('camposIniciais').item.json.whatsapp.evo.nomeInstancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('camposIniciais').item.json.whatsapp.evo.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('camposIniciais').item.json.meta.telefoneCliente }}"},{"name":"text","value":"={{ $json.text }}"},{"name":"linkPreview","value":"={{ $('camposIniciais').item.json.linkPreview }}"},{"name":"delay","value":"={{ $('camposIniciais').item.json.Digitando }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"20eea349-cba3-4ce4-9f84-2561e7110655","name":"Responde texto1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4280,540]},{"parameters":{"assignments":{"assignments":[{"id":"2c845210-2c6b-4bf1-b975-00b9e82e80f1","name":"text","value":"={{ $json.output.replace(/\\*\\*/g, '*') }}","type":"string"}]},"options":{}},"id":"25db8100-d96f-47e9-9e16-7b096aa98e13","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[4080,540]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"60065893-74f7-4b64-bc1a-d891202efa78","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0cb14635-2673-408e-86db-ce9e0373674b","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Ãudio"}]},"options":{}},"id":"c7089690-5f3e-4d5f-abd8-fde4c5901a46","name":"Switch2","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1520,680]},{"parameters":{"httpMethod":"POST","path":"delivery","options":{}},"id":"a95b7f90-d117-4bba-9cb1-a0c604fa3ed2","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-700,680],"webhookId":"a97b04c1-9d2e-49e7-9502-8ccf7301006f"},{"parameters":{"promptType":"define","text":"={{ $('messages').all()[0].json.messages }}","options":{"systemMessage":"=<!-- Mensagem do UsuÃ¡rio -->\n<userMessage>\n  Essa Ã© a mensagem do cliente: {{ $('messages').all()[0].json.messages }}\n</userMessage>\n\n<prompt> \n{{ $('Prompts').item.json.systemMessageAgente }}\n</prompt>","maxIterations":30,"returnIntermediateSteps":true,"passthroughBinaryImages":true}},"id":"61afb2bb-12ad-426d-aba9-e1968ee715e1","name":"Agente Atendimento Delivery","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[3300,520],"retryOnFail":false},{"parameters":{"name":"enviar_cardapio","description":"Use essa tool para enviar o cardapio em pdf no inÃ­cio da conversa ou quando o cliente solicitar","workflowId":{"__rl":true,"value":"HrQHIRgnadt5xbMG","mode":"list","cachedResultName":"ENVIA CARDÃPIO"},"fields":{"values":[{"name":"nomeCliente","stringValue":"={{ $('camposIniciais').item.json.meta.nomeCliente }}"},{"name":"telefoneCliente","stringValue":"={{ $('camposIniciais').item.json.meta.telefoneCliente }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[3700,800],"id":"14d4646c-d156-4f86-b7b7-bfd90ad2bd3e","name":"enviar_cardapio"},{"parameters":{"content":"","height":657,"width":599,"color":6},"id":"cd8a5f62-6c38-4cf8-9cd1-a48f46a94aa6","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4060,380]},{"parameters":{"content":"Responde o cliente com textos Ãºnico (otimizando o tempo de resposta)","height":80,"width":202,"color":4},"id":"341b89a1-64c8-4599-aa16-d7a8b001119e","name":"Sticky Note19","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4100,400]},{"parameters":{"method":"POST","url":"={{ $('camposIniciais').item.json.whatsapp.evo.server_url }}/message/sendText/{{ $('camposIniciais').item.json.whatsapp.evo.nomeInstancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('camposIniciais').item.json.whatsapp.evo.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('camposIniciais').item.json.telefoneCliente }}"},{"name":"text","value":"=NÃ£o entendo imagens, digite ou envie um Ã¡udio por favor"}]},"options":{"redirect":{"redirect":{}}}},"id":"13977c5a-4f65-4e23-b703-812b34f43529","name":"Resposta - NÃ£o leio imagem","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1740,500]},{"parameters":{"name":"cardapio_bucaneiro","description":"use essa tool quando o usurÃ¡rio desejar fazer um pedido de algum item do cardÃ¡pio"},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[3360,840],"id":"d6d427cc-fa28-4a40-929d-f4787135cba7","name":"Vector Store Tool"},{"parameters":{"tableName":{"__rl":true,"value":"documents_delivery","mode":"list","cachedResultName":"documents_delivery"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[3220,1000],"id":"82c7d193-45d1-407f-bbd8-3bf5be7c0fd3","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[3260,1140],"id":"f0d95465-2676-4941-a630-8766bf820a6a","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"y6EOm7GTWxcYjDT6","name":"OpenAi Allan"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[3520,980],"id":"ee162b19-5c78-434e-9247-15bfe8e27c4d","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"y6EOm7GTWxcYjDT6","name":"OpenAi Allan"}}},{"parameters":{"name":"atualiza_endereco","description":"Use essa tool para cadastrar e atualizar o endereÃ§o do cliente","workflowId":{"__rl":true,"value":"nsaKY2VLC20XwzLV","mode":"id"},"fields":{"values":[{"name":"nomeCliente","stringValue":"={{ $('camposIniciais').item.json.meta.nomeCliente }}"},{"name":"telefoneCliente","stringValue":"={{ $('camposIniciais').item.json.meta.telefoneCliente }}"}]},"jsonSchemaExample":"{\n\t\"endereco\": \"Rua Nova, Centro, Alagoas\"\n}"},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[3840,800],"id":"f0b631fc-11cc-4a8a-8e17-49d026d80a35","name":"atualiza_endereco"},{"parameters":{},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[3000,1500],"id":"06fe2f6e-e214-4063-a757-bac5c261e5f0","name":"Execute Workflow Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"79625d22-84b0-4d0d-b661-9a471719ff6a","name":"nomeCliente","value":"={{ $json.nomeCliente }}","type":"string"},{"id":"b9c0ef22-5a16-45e7-a59c-ad2382d8caec","name":"telefoneCliente","value":"={{ $json.telefoneCliente }}","type":"string"},{"id":"c206a094-e75b-4379-93a4-97868c277ee4","name":"enderecoCliente","value":"={{ $json.query }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3280,1500],"id":"a899eb50-118e-4abd-aff7-8b0b763b43ec","name":"Edit Fields1"},{"parameters":{"operation":"update","tableId":"documents_delivery","filters":{"conditions":[{"keyName":"telefoneCliente","condition":"eq","keyValue":"={{ $json.telefoneCliente }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"enderecoCliente","fieldValue":"={{ $json.enderecoCliente }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3540,1500],"id":"43d6b1e4-49f4-4288-b717-455f6cf49046","name":"Supabase2","credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"assignments":{"assignments":[{"id":"73d6e94f-b073-4584-a1cc-0f7791e29664","name":"response","value":"ok","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3840,1500],"id":"1d5d267f-0970-47ac-b7f1-8e3fb54ac50c","name":"Edit Fields2"},{"parameters":{"content":"## ATUALIZA ENDEREÃ‡O\n","height":400,"width":1180},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2880,1360],"id":"234e5685-00f4-4906-a9bc-7c62e5a757a2","name":"Sticky Note2"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1UKxlLClcdFbzITLciDhWInU0uP3rrthX","mode":"list","cachedResultName":"RAG DELIVERY","cachedResultUrl":"https://drive.google.com/drive/folders/1UKxlLClcdFbzITLciDhWInU0uP3rrthX"},"event":"fileCreated","options":{}},"id":"2f27744c-8d5b-4d65-a55f-a9dce0a4e07c","name":"Google Drive Trigger","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[1780,1140],"credentials":{"googleDriveOAuth2Api":{"id":"cQnW1e2PklBVDK61","name":"Google Drive allan"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Edit Fields10').item.json.id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"4edb8ca3-b271-49bd-9241-90901401f55e","name":"Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1780,1400],"credentials":{"googleDriveOAuth2Api":{"id":"cQnW1e2PklBVDK61","name":"Google Drive allan"}}},{"parameters":{"operation":"pdf","options":{}},"id":"9023c325-3c7d-4473-be2e-5b39b533fb66","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1960,1400]},{"parameters":{"options":{}},"id":"9b181abc-3dd7-42f8-921a-73e3614f9c1a","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.1,"position":[2340,1560],"credentials":{"openAiApi":{"id":"y6EOm7GTWxcYjDT6","name":"OpenAi Allan"}}},{"parameters":{"options":{}},"id":"c38d17fc-ddb1-4159-bd79-cfc22015a616","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[2480,1560]},{"parameters":{"chunkOverlap":200,"options":{}},"id":"b741c672-f3c1-496f-9163-ee68883498c5","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[2620,1680]},{"parameters":{"operation":"delete","tableId":"documents_delivery","filterType":"string","filterString":"=metadata->>file_id=like.*{{ $json.id }}*"},"id":"a02d25ae-cea1-4cc1-8c22-a40c3ff74a40","name":"Supabase14","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2480,1140],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"assignments":{"assignments":[{"id":"1b9ce002-32a7-4f00-9eb5-e84c621bbd1e","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"id":"e33cd773-9350-4274-b896-90ca2b4da7af","name":"Edit Fields10","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2020,1140]},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents_delivery","mode":"list","cachedResultName":"documents_delivery"},"options":{"queryName":"match_documents"}},"id":"ddd7959d-bd1f-423b-bb20-1f241d351b5a","name":"Supabase Vector Store1","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[2360,1400],"credentials":{"supabaseApi":{"id":"KaCYtyFsV445mYmt","name":"Supabase Allan"}}},{"parameters":{"content":"## RAG\n","height":680,"width":1180},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1620,1120],"id":"c50aca39-9e04-4a76-9291-ae287af8e364","name":"Sticky Note9"},{"parameters":{"content":"```\n â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—\nâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•\nâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• \nâ–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•      â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â•šâ–ˆâ–ˆâ•”â•  \nâ–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   \nâ•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•    â•šâ•â•â•šâ•â•  â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•   ","height":180,"width":1420},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1460,100],"id":"7e4e59d9-d2b2-4618-91de-f6f7a1acb7bd","name":"Sticky Note10"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Agente Atendimento Delivery","type":"ai_languageModel","index":0}]]},"NoOp.4":{"main":[[{"node":"UnificaDados","type":"main","index":1}]]},"Wait":{"main":[[{"node":"Obtem","type":"main","index":0}]]},"messages":{"main":[[{"node":"Agente Atendimento Delivery","type":"main","index":0}]]},"empilhaTexto":{"main":[[{"node":"Obtem","type":"main","index":0}]]},"Obtem":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Deleta":{"main":[[{"node":"messages","type":"main","index":0}]]},"Prompts":{"main":[[{"node":"UnificaDados","type":"main","index":0}]]},"empilhaÃudio":{"main":[[{"node":"Obtem","type":"main","index":0}]]},"camposIniciais":{"main":[[{"node":"Prompts","type":"main","index":0},{"node":"NoOp.4","type":"main","index":0}]]},"getClient":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"fromMe","type":"main","index":0}],[{"node":"GeraUUID","type":"main","index":0}]]},"CreateUser":{"main":[[{"node":"getClient","type":"main","index":0}]]},"GeraUUID":{"main":[[{"node":"CreateUser","type":"main","index":0}]]},"Calculadora":{"ai_tool":[[{"node":"Agente Atendimento Delivery","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Agente Atendimento Delivery","type":"ai_memory","index":0}]]},"fromMe":{"main":[[{"node":"NOP1","type":"main","index":0}],[{"node":"Switch2","type":"main","index":0}]]},"When clicking â€˜Test workflowâ€™":{"main":[[{"node":"Chat Memory Manager","type":"main","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Chat Memory Manager","type":"ai_memory","index":0}]]},"UnificaDados":{"main":[[{"node":"getClient","type":"main","index":0}]]},"Switch":{"main":[[{"node":"NoOp.","type":"main","index":0}],[{"node":"Deleta","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"informacoes_bucaneiro":{"ai_tool":[[{"node":"Agente Atendimento Delivery","type":"ai_tool","index":0}]]},"Edit Fields":{"main":[[{"node":"Responde texto1","type":"main","index":0}]]},"Switch2":{"main":[[{"node":"Resposta - NÃ£o leio imagem","type":"main","index":0}],[{"node":"empilhaTexto","type":"main","index":0}],[{"node":"empilhaÃudio","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"camposIniciais","type":"main","index":0}]]},"Agente Atendimento Delivery":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"enviar_cardapio":{"ai_tool":[[{"node":"Agente Atendimento Delivery","type":"ai_tool","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"Agente Atendimento Delivery","type":"ai_tool","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"atualiza_endereco":{"ai_tool":[[{"node":"Agente Atendimento Delivery","type":"ai_tool","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Supabase2","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Google Drive Trigger":{"main":[[{"node":"Edit Fields10","type":"main","index":0}]]},"Google Drive":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Supabase Vector Store1","type":"main","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store1","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Supabase14":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Edit Fields10":{"main":[[{"node":"Supabase14","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c85265cc-1432-44a2-80f1-ff5f8df2dda0","triggerCount":0,"tags":[]}